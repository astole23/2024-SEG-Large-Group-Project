{% extends 'employer_base.html' %}
{% load static %}

{% block main_content %}
<div class="dashboard-container">
    <div class="company-header">
        <div class="company-logo-container">
            <a href="{% url 'edit_company' company_id=user.id %}">Edit Profile</a>

            {% if company.logo %}
                <img src="{{ company.logo.url }}" alt="{{ company.company_name }} Logo" class="company-logo">
            {% else %}
                <div class="placeholder-logo">No Logo</div>
            {% endif %}
            <h1 class="company-name">{{ company.company_name }}</h1>
        </div>

        <div class="review-box">
            <button class="review-button" id="reviewButton">Review Company</button>
        </div>

        <hr class="company-divider">
        <p class="company-industry"><strong>Industry:</strong> {{ company.industry }}</p>
    </div>

    <div class="company-contact">
        <p><strong>Email:</strong> {{ company.email }}</p>
        <p><strong>Phone:</strong> {{ company.phone }}</p>
        <p><strong>Headquarters:</strong> {{ company.location }}</p>
    </div>

    <section class="job-listings">
        <h2>Job Listings</h2>
        <div class="scrollable-section">
            <div class="grid-container">
              {% if job_postings %}
                {% for job in job_postings %}
                  <div class="grid-button card shadow-sm p-3 mb-4">
                    <h5>{{ job.job_title }}</h5>
                    <p>{{ job.company.company_name }}</p>
                    <p>{{ job.location }}</p>
                    <p>{{ job.work_type }}</p>
                    <p>{{ job.company_overview|truncatewords:10 }}</p>
                    <button class="btn btn-secondary mt-2" data-bs-toggle="modal" data-bs-target="#jobModal{{ job.id }}">View More</button>
                  </div>
                {% endfor %}
              {% else %}
                <p class="text-muted">No job postings available.</p>
              {% endif %}
            </div>
        </div>
    </section>

    <!-- Review Modal -->
    <div id="reviewModal" class="modal" aria-hidden="true" role="dialog">
        <div class="modal-content">
            <span class="close" id="closeModal">&times;</span>
            <h2>Leave a Review</h2>

            <!-- Traditional HTML Form -->
            <form method="POST" action="{% url 'leave_review' company_id=company.id %}">
                {% csrf_token %}
                <div class="form-group">
                    <label for="reviewText">Review Text:</label>
                    <textarea id="reviewText" name="text" rows="4" required></textarea>
                </div>

                <div class="form-group">
                    <label for="reviewRating">Rating:</label>
                    <select id="reviewRating" name="rating" required>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                    </select>
                </div>

                <button type="submit" class="submit-review">Submit Review</button>
            </form>
        </div>
    </div>
</div>

<!-- Simple JS for Modal (optional but recommended for UX) -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const reviewButton = document.getElementById('reviewButton');
        const reviewModal = document.getElementById('reviewModal');
        const closeModal = document.getElementById('closeModal');

        reviewButton.onclick = () => reviewModal.style.display = 'block';
        closeModal.onclick = () => reviewModal.style.display = 'none';
        
        window.onclick = event => {
            if (event.target === reviewModal) reviewModal.style.display = 'none';
        };

        document.onkeydown = event => {
            if (event.key === 'Escape') reviewModal.style.display = 'none';
        };
    });
</script>

{% endblock %}

{% block extra_stylesheets %}
    <link rel="stylesheet" href="{% static 'css/company_detail.css' %}">
{% endblock %}
