<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Applications Status</title>
  <style>
    :root {
      --primary-color: #4b0082;
      --secondary-color: #475569;
      --background-color: #f8fafc;
      --card-background: #ffffff;
      --border-color: #e2e8f0;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --highlight-color: #6a0dad; /* For the "active" stages */
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: Inter, system-ui, sans-serif;
      background-color: var(--background-color);
      color: var(--text-primary);
      line-height: 1.5;
    }

    /* Navbar */
    .navbar {
      background-color: var(--primary-color);
      color: white;
      padding: 1rem 2rem;
      position: fixed;
      width: 100%;
      z-index: 10;
      top: 0;
      left: 0;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .navbar .navbar-brand {
      color: white;
      font-size: 1.5rem;
      font-weight: bold;
      text-decoration: none;
    }
    .nav-right-actions {
      display: flex;
      gap: 1rem;
      align-items: center;
    }
    .nav-btn {
      background-color: #6a0dad;
      border: none;
      padding: 0.75rem 1.25rem;
      border-radius: 5px;
      color: white;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    .nav-btn:hover {
      background-color: #3a0069;
    }

    /* Purple Background with Overlay */
    .status-background {
      position: relative; /* needed for child pseudo-element positioning */
      margin-right: 0;
      padding: 40px 20px;
      height: 100vh;
      overflow-y: auto;
      background-image: url('/static/contact_us_background.jpg');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      padding-top: 5rem;
      width: 100vw;
      z-index: 0; /* base layer */
    }
    .status-background::before {
      content: '';
      position: absolute;
      inset: 0;          /* top: 0; left: 0; right: 0; bottom: 0 */
      background-color: rgba(128, 0, 128, 0.2);
      z-index: -1;       /* behind all child elements */
    }

    /* Main container for the page content */
    .page-content {
      max-width: 800px;
      margin: 5rem auto 2rem auto; /* push content below navbar */
      padding: 1rem;
      position: relative; /* ensure content is above the overlay */
      z-index: 1;         /* above the overlay's -1 */
    }

    /* Title */
    .page-title {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    .page-title h1 {
      font-size: 1.75rem;
      /* Changed to white as requested */
      color: white;
    }

    /* Job Cards */
    .job-card {
      background-color: var(--card-background);
      display: flex;
      align-items: center;
      padding: 1rem;
      margin-bottom: 1rem;
      border-radius: 0.5rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      position: relative; /* so the star can be absolutely positioned */
    }
    .job-info {
      flex: 1;
    }
    .job-title {
      font-size: 1.25rem;
      font-weight: bold;
      margin-bottom: 0.25rem;
    }
    .company-name {
      font-size: 1rem;
      color: var(--text-secondary);
      margin-bottom: 0.5rem;
    }

    /* Star Icon (for un-starring) */
    .star-icon {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      font-size: 1.25rem;
      cursor: pointer;
      color: gold;
      transition: transform 0.2s;
    }
    .star-icon:hover {
      transform: scale(1.1);
    }

    /* Status Bar */
    .status-bar {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-top: 0.5rem;
    }
    .status-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      transition: color 0.3s;
    }
    .circle {
      width: 1.5rem;
      height: 1.5rem;
      border-radius: 50%;
      background-color: white;
      border: 2px solid var(--border-color);
      margin-bottom: 0.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--border-color);
    }
    .step-label {
      font-size: 0.75rem;
      color: var(--text-secondary);
      text-align: center;
      width: 4.5rem; /* so the text doesn't overlap */
    }
    /* The line connecting steps */
    .status-bar .bar {
      flex: 1;
      height: 2px;
      background-color: var(--border-color);
      position: relative;
      top: -1rem; /* visually center the line */
    }
    /* Active or completed step style */
    .status-step.active .circle {
      background-color: var(--highlight-color);
      border-color: var(--highlight-color);
      color: white;
    }
    .status-step.active .step-label {
      color: var(--highlight-color);
    }

    /* For star un-starring confirmation */
    .modal-overlay, .add-jobs-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    .modal-content, .add-jobs-content {
      background-color: white;
      padding: 2rem;
      border-radius: 0.5rem;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      text-align: center;
    }
    .modal-btns, .popup-btns {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 1rem;
    }
    .modal-btns button, .popup-btns button {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
    }
    .confirm-btn {
      background-color: var(--primary-color);
      color: white;
    }
    .cancel-btn {
      background-color: #ccc;
      color: black;
    }

    /* Add Jobs Popup */
    .add-jobs-list {
      max-height: 200px;
      overflow-y: auto;
      margin-top: 1rem;
      text-align: left;
    }
    .job-option {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 0.5rem;
      padding: 0.5rem;
      border: 1px solid var(--border-color);
      border-radius: 5px;
      cursor: pointer;
    }
    .job-option:hover {
      background-color: var(--background-color);
    }
    .job-option input {
      margin-right: 0.5rem;
    }
  </style>
</head>
<body>
  <!-- NAVBAR -->
  <div class="navbar">
    <a href="#" class="navbar-brand">SHY - My Applications</a>
    <div class="nav-right-actions">
      <button class="nav-btn" onclick="openAddJobsPopup()">+ Add Jobs</button>
    </div>
  </div>

  <!-- MAIN PAGE CONTENT -->
  <div class="status-background">
    <div class="page-content">
      <div class="page-title">
        <h1>Starred Applications</h1>
      </div>

      <!-- Container for starred job cards -->
      <div id="starred-jobs-container">
        <!-- Example job cards will be injected via JS for demonstration -->
      </div>
    </div>
  </div>

  <!-- UNSTAR CONFIRMATION POPUP -->
  <div class="modal-overlay" id="unstarModal">
    <div class="modal-content">
      <h2>Unstar This Job?</h2>
      <p>Are you sure you want to unstar this job application?</p>
      <div class="modal-btns">
        <button class="confirm-btn" id="confirmUnstar">Yes</button>
        <button class="cancel-btn" onclick="closeUnstarModal()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- ADD JOBS POPUP -->
  <div class="add-jobs-overlay" id="addJobsModal">
    <div class="add-jobs-content">
      <h2>Select Jobs to Star</h2>
      <p>Choose from your unstarred applications:</p>
      <div class="add-jobs-list" id="unstarred-jobs-list"></div>
      <div class="popup-btns">
        <button class="confirm-btn" onclick="confirmAddJobs()">Done</button>
        <button class="cancel-btn" onclick="closeAddJobsPopup()">Cancel</button>
      </div>
    </div>
  </div>

  <script>
    /*************************************************************
      Mock Data
     *************************************************************/
    const allJobs = [
      { id: 1, title: 'Frontend Developer', company: 'Google', currentStage: 3, starred: true },
      { id: 2, title: 'Backend Engineer', company: 'Amazon', currentStage: 0, starred: false },
      { id: 3, title: 'Data Scientist', company: 'Meta', currentStage: 0, starred: false },
      { id: 4, title: 'QA Analyst', company: 'Apple', currentStage: 1, starred: true },
      { id: 5, title: 'DevOps Specialist', company: 'Microsoft', currentStage: 0, starred: false }
    ];

    const stageNames = [
      'Applied',
      'Review',
      'Interview',
      'Assessment',
      'Decision',
      'Offer'
    ];

    let jobToUnstar = null;

    /*************************************************************
      Rendering Starred Jobs
     *************************************************************/
    function renderStarredJobs() {
      const container = document.getElementById('starred-jobs-container');
      container.innerHTML = '';

      // Filter for starred
      const starred = allJobs.filter(job => job.starred);

      starred.forEach(job => {
        const card = document.createElement('div');
        card.className = 'job-card';

        const jobInfo = document.createElement('div');
        jobInfo.className = 'job-info';

        const titleEl = document.createElement('div');
        titleEl.className = 'job-title';
        titleEl.textContent = job.title;

        const companyEl = document.createElement('div');
        companyEl.className = 'company-name';
        companyEl.textContent = job.company;

        jobInfo.appendChild(titleEl);
        jobInfo.appendChild(companyEl);

        // Create the status bar
        const statusBar = createStatusBar(job);
        jobInfo.appendChild(statusBar);

        card.appendChild(jobInfo);

        // Star icon for un-starring
        const starEl = document.createElement('div');
        starEl.className = 'star-icon';
        starEl.textContent = 'â˜…';
        starEl.onclick = () => openUnstarModal(job);
        card.appendChild(starEl);

        container.appendChild(card);
      });
    }

    // Creates the 6-step status bar with labels
    function createStatusBar(job) {
      const statusWrapper = document.createElement('div');
      statusWrapper.className = 'status-bar';

      // 6 steps total
      for (let i = 0; i < 6; i++) {
        // If not the first circle, insert a connecting line
        if(i > 0) {
          const lineDiv = document.createElement('div');
          lineDiv.className = 'bar';
          statusWrapper.appendChild(lineDiv);
        }

        const stepDiv = document.createElement('div');
        stepDiv.className = 'status-step';

        // Circle
        const circleDiv = document.createElement('div');
        circleDiv.className = 'circle';
        circleDiv.textContent = i + 1; // Or display an icon instead of a number.

        // Label
        const labelDiv = document.createElement('div');
        labelDiv.className = 'step-label';
        labelDiv.textContent = stageNames[i];

        // Mark as active if the job's currentStage is >= i
        if (job.currentStage >= i) {
          stepDiv.classList.add('active');
        }

        // Click => set job's current stage to i
        stepDiv.onclick = () => {
          job.currentStage = i;
          renderStarredJobs();
        };

        stepDiv.appendChild(circleDiv);
        stepDiv.appendChild(labelDiv);

        statusWrapper.appendChild(stepDiv);
      }

      return statusWrapper;
    }

    /*************************************************************
      Unstar Logic
     *************************************************************/
    function openUnstarModal(job) {
      jobToUnstar = job;
      document.getElementById('unstarModal').style.display = 'flex';
    }
    function closeUnstarModal() {
      jobToUnstar = null;
      document.getElementById('unstarModal').style.display = 'none';
    }
    document.getElementById('confirmUnstar').onclick = function() {
      if(jobToUnstar) {
        jobToUnstar.starred = false;
      }
      closeUnstarModal();
      renderStarredJobs();
    };

    /*************************************************************
      Add Jobs Popup
     *************************************************************/
    function openAddJobsPopup() {
      const unstarredList = document.getElementById('unstarred-jobs-list');
      unstarredList.innerHTML = '';

      const unstarred = allJobs.filter(j => !j.starred);
      unstarred.forEach(job => {
        const jobOption = document.createElement('div');
        jobOption.className = 'job-option';

        const label = document.createElement('label');
        label.style.width = '100%';
        label.textContent = `${job.title} @ ${job.company}`;

        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.value = job.id;

        jobOption.appendChild(checkbox);
        jobOption.appendChild(label);

        unstarredList.appendChild(jobOption);
      });

      document.getElementById('addJobsModal').style.display = 'flex';
    }
    function closeAddJobsPopup() {
      document.getElementById('addJobsModal').style.display = 'none';
    }

    function confirmAddJobs() {
      const unstarredList = document.getElementById('unstarred-jobs-list');
      const checkboxes = unstarredList.querySelectorAll('input[type="checkbox"]:checked');
      checkboxes.forEach(cb => {
        const job = allJobs.find(j => j.id === parseInt(cb.value));
        if(job) job.starred = true;
      });
      closeAddJobsPopup();
      renderStarredJobs();
    }

    /*************************************************************
      Initialize
     *************************************************************/
    window.onload = () => {
      renderStarredJobs();
    };
  </script>
</body>
</html>
